


### 公网ip:
```bash
curl cip.cc # 查看公网Ip
curl ifconfig.me # 查看公网Ip
ifconfig -a #查看Linux的内网IP地址

```

### 几个重要的配置文件：
```/etc/resolv.conf ```  
```/etc/sysconfig/network-scripts/ifcfg-ens33```
```bash
$ cat /etc/resolv.conf 
# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 114.114.114.114

$ cat /etc/sysconfig/network-scripts/ifcfg-ens33 #可以没有DNS设置
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="static" #必须设置
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="ens33"
UUID="1b0b9593-650f-4276-b257-86bc51b88b01"
DEVICE="ens33"
IPADDR="192.168.5.100" #必须设置
GATEWAY="192.168.5.2" #必须设置
ONBOOT="yes" #必须设置



#编辑之后别忘了重启
systemctl restart network

```
### dns相关：

```bash
host -a baidu.com  #
[root@centos ~]#  host -a baidu.com
Trying "baidu.com"
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 52828
;; flags: qr rd ra; QUERY: 1, ANSWER: 8, AUTHORITY: 5, ADDITIONAL: 9

;; QUESTION SECTION:
;baidu.com.			IN	ANY

;; ANSWER SECTION:
baidu.com.		1187	IN	SOA	dns.baidu.com. sa.baidu.com. 2012145946 300 300 2592000 7200
baidu.com.		563	IN	A	110.242.68.66
baidu.com.		563	IN	A	39.156.66.10
baidu.com.		53855	IN	NS	dns.baidu.com.
baidu.com.		53855	IN	NS	ns3.baidu.com.
baidu.com.		53855	IN	NS	ns2.baidu.com.
baidu.com.		53855	IN	NS	ns4.baidu.com.
baidu.com.		53855	IN	NS	ns7.baidu.com.

;; AUTHORITY SECTION:
baidu.com.		53855	IN	NS	ns7.baidu.com.
baidu.com.		53855	IN	NS	ns4.baidu.com.
baidu.com.		53855	IN	NS	ns3.baidu.com.
baidu.com.		53855	IN	NS	ns2.baidu.com.
baidu.com.		53855	IN	NS	dns.baidu.com.

;; ADDITIONAL SECTION:
dns.baidu.com.		229	IN	A	110.242.68.134
ns2.baidu.com.		17206	IN	A	220.181.33.31
ns3.baidu.com.		12849	IN	A	112.80.248.64
ns3.baidu.com.		12849	IN	A	36.152.45.193
ns4.baidu.com.		33256	IN	A	14.215.178.80
ns4.baidu.com.		33256	IN	A	111.45.3.226
ns7.baidu.com.		23056	IN	A	180.76.76.92
ns7.baidu.com.		18540	IN	AAAA	240e:940:603:4:0:ff:b01b:589a
ns7.baidu.com.		18540	IN	AAAA	240e:bf:b801:1002:0:ff:b024:26de

[root@centos ~]# ping baidu.com
PING baidu.com (39.156.66.10) 56(84) bytes of data.
64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq=1 ttl=128 time=50.8 ms
64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq=2 ttl=128 time=53.4 ms
^C
--- baidu.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 50.840/52.144/53.449/1.324 ms
[root@centos ~]# 

```
### /etc/resolv.conf文件中的search项作用 
refered to : https://www.shuzhiduo.com/A/x9J2Q7egz6/  
DNS配置文件如下
```bash
# vi /etc/resolv.conf
# Generated by NetworkManager
search openstack.local dev.com example.local
nameserver 192.168.122.21
```
例1：查询主机名，因为主机名后面没有点，就认为是主机名，所以先添加search里的每一项依次组成FQDN（完全合格域名）来查询，完全合格域名查询未找到，就再认为主机名是完全合格域名来查询
```bash
# host -a centos7-bind-1
Trying "centos7-bind-1.openstack.local"
Trying "centos7-bind-1.dev.com"
Trying "centos7-bind-1.example.local"
Trying "centos7-bind-1"
;; connection timed out; no servers could be reached
```


### 
https://mp.weixin.qq.com/s/saivLvkF0watg2nHxrO5-Q
```bash

ip link set x up # Bring up interface x. ip link set lo up
ip link set x down  # Bring down interface x.


ip link add type veth #添加一对veth pair
ip a
4: veth0@veth1: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether 0a:f4:e2:2d:37:fb brd ff:ff:ff:ff:ff:ff
5: veth1@veth0: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether 5e:7e:f6:59:f0:4f brd ff:ff:ff:ff:ff:ff


ip netns add ns0
ip netns add ns1

ip link set veth0 netns ns0   #将 veth0 加入到 ns0，将 veth1 加入到 XX namespace 中
ip link set veth1 netns ns1

ip netns exec ns0 ip link set veth0 up  #启用
ip netns exec ns1 ip link set veth1 up

ip netns exec ns0 ip addr #查看  ip -n ns0 addr
ip netns exec ns1 ip addr

ip netns exec ns0 ip addr add 192.0.0.1/24 dev veth0 
ip netns exec ns1 ip addr add 192.0.0.2/24 dev veth1

```

```bash
docker network create -d bridge --subnet "192.168.2.0/24" --gateway "192.168.2.1" br0   
docker network ls
docker run -it --name b1 --network br0 busybox

[root@localhost ~]# docker run -it --name t1 --network bridge --rm busybox
/ # cat /etc/hosts
127.0.0.1 localhost

```
`kubectl get pod multi-container-pod -o jsonpath={.status.podIP}`

#### ip netns list
```bash
gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a ~ # ip netns list
cni-f5965155-3a25-d093-6151-d4d57986c41a (id: 0)
cni-6f88984a-5f5e-ac5d-6ac1-f0b02e90f7ca (id: 22)
cni-a48950b5-fe9b-4734-b977-194e524216da (id: 21)
cni-e13aba5b-920d-5a7e-5c79-19a3dd901164 (id: 20)
cni-6d97819b-9df2-3e7b-7745-dc363be9f783 (id: 19)
cni-616ddbf9-7696-23a1-0138-1e5ac6600a1d (id: 18)
cni-012869c6-14a3-21e9-5e5d-e3c2b159dca5 (id: 16)
cni-9e381566-e8f5-75d8-c584-c94449782775 (id: 15)
cni-117e1f68-a757-cbd8-9353-69d71d16fa9f (id: 14)
cni-408d7fa8-1eb5-98c5-6936-ee2e16f760a6 (id: 13)
cni-e95a06bc-2306-2ed6-e0b0-11aa12e60ef2 (id: 12)
cni-468b9573-e0f6-bdf2-db2a-3620ea7cdafd (id: 11)
cni-38ede521-ca73-565b-0f71-842f214c7943 (id: 10)
cni-a3f29d80-7828-1b68-18df-3c7748604630 (id: 4)
cni-0886c3bd-0bd1-8662-c055-d410bb5176ac (id: 9)
cni-a0ad1e23-609e-a932-56bf-de8047157ecd (id: 5)
cni-39187cfe-fa4f-0614-fef8-2f98fbe905ed (id: 8)
cni-a4ef088b-1b39-882a-b35a-a4f9ed6a2f5a (id: 7)
cni-477f0414-4af8-98ba-7d4c-03052e24027a (id: 6)
cni-1aa06e4a-0d4b-3bf7-1dfc-b034a5ade446 (id: 3)
cni-dec45f7b-b65a-29a2-274d-2c0779ad307d (id: 2)
cni-d15c6046-9c21-147e-63cd-b5f9703bc22c (id: 1)
```

#### ls -lt /var/run/netns
```bash
gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a ~ # ls -lt /var/run/netns
total 0
-r--r--r-- 1 root root 0 Aug 22 06:41 cni-f5965155-3a25-d093-6151-d4d57986c41a
-r--r--r-- 1 root root 0 Aug 21 23:27 cni-6f88984a-5f5e-ac5d-6ac1-f0b02e90f7ca
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-a48950b5-fe9b-4734-b977-194e524216da
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-e13aba5b-920d-5a7e-5c79-19a3dd901164
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-6d97819b-9df2-3e7b-7745-dc363be9f783
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-616ddbf9-7696-23a1-0138-1e5ac6600a1d
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-012869c6-14a3-21e9-5e5d-e3c2b159dca5
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-9e381566-e8f5-75d8-c584-c94449782775
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-117e1f68-a757-cbd8-9353-69d71d16fa9f
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-408d7fa8-1eb5-98c5-6936-ee2e16f760a6
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-e95a06bc-2306-2ed6-e0b0-11aa12e60ef2
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-468b9573-e0f6-bdf2-db2a-3620ea7cdafd
-r--r--r-- 1 root root 0 Aug 21 17:02 cni-38ede521-ca73-565b-0f71-842f214c7943
-r--r--r-- 1 root root 0 Aug 11 17:19 cni-a3f29d80-7828-1b68-18df-3c7748604630
-r--r--r-- 1 root root 0 Jul 18 14:44 cni-0886c3bd-0bd1-8662-c055-d410bb5176ac
-r--r--r-- 1 root root 0 Jul 18 14:44 cni-a0ad1e23-609e-a932-56bf-de8047157ecd
-r--r--r-- 1 root root 0 Jul 18 14:42 cni-39187cfe-fa4f-0614-fef8-2f98fbe905ed
-r--r--r-- 1 root root 0 Jul 18 14:42 cni-a4ef088b-1b39-882a-b35a-a4f9ed6a2f5a
-r--r--r-- 1 root root 0 Jul 18 14:41 cni-477f0414-4af8-98ba-7d4c-03052e24027a
-r--r--r-- 1 root root 0 Jul 18 14:41 cni-1aa06e4a-0d4b-3bf7-1dfc-b034a5ade446
-r--r--r-- 1 root root 0 Jul 18 14:41 cni-dec45f7b-b65a-29a2-274d-2c0779ad307d
-r--r--r-- 1 root root 0 Jul 18 14:41 cni-d15c6046-9c21-147e-63cd-b5f9703bc22c

```
#### ip netns exec cni-408d7fa8-1eb5-98c5-6936-ee2e16f760a6  ip a 
```bash
#应该就是这个pod opentelemetry-demo-checkoutservice-59bf6bfc7-xrdd5
gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a ~ # ip netns exec cni-408d7fa8-1eb5-98c5-6936-ee2e16f760a6  ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: eth0@if24: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1460 qdisc noqueue state UP group default 
    link/ether 6a:b3:eb:65:bd:99 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.64.209.22/24 brd 10.64.209.255 scope global eth0
       valid_lft forever preferred_lft forever

```
#### ip link | grep -A1 ^24
```
gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a ~ # ip link | grep -A1 ^24
24: vethd4702632@if2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1460 qdisc noqueue state UP mode DEFAULT group default 
    link/ether c2:ac:0b:4f:6c:2e brd ff:ff:ff:ff:ff:ff link-netns cni-408d7fa8-1eb5-98c5-6936-ee2e16f760a6
```
#### ip netns exec cni-408d7fa8-1eb5-98c5-6936-ee2e16f760a6 netstat -lnp
```
gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a ~ # ip netns exec cni-408d7fa8-1eb5-98c5-6936-ee2e16f760a6 netstat -lnp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp6       0      0 :::8080                 :::*                    LISTEN      82743/./checkoutser 
Active UNIX domain sockets (only servers)
Proto RefCnt Flags       Type       State         I-Node   PID/Program name     Path

#回到kubectl中看
 ⚡ root@fli-mbp  ~  k get pod -A -o wide|grep 10.64.209.2  
otel-demo     opentelemetry-demo-accountingservice-58c549dfcd-nst9m       1/1     Running                  0               8d      10.64.209.20   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-adservice-5d48dfff58-qtcnp               1/1     Running                  0               8d      10.64.209.21   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-checkoutservice-59bf6bfc7-xrdd5          1/1     Running                  0               8d      10.64.209.22   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-emailservice-c45d9b549-wb6bt             1/1     Running                  22 (8h ago)     8d      10.64.209.23   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-ffspostgres-554dfbcb9b-25n54             1/1     Running                  0               8d      10.64.209.24   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-frontend-599dcf8c55-fpb5k                1/1     Running                  0               8d      10.64.209.25   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-loadgenerator-65c6f9d4f7-2ndf5           1/1     Running                  3 (36h ago)     8d      10.64.209.27   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-paymentservice-749587f6fd-5r58c          1/1     Running                  0               8d      10.64.209.28   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>
otel-demo     opentelemetry-demo-productcatalogservice-5474c9697c-6nh6b   1/1     Running                  0               8d      10.64.209.29   gke-twc-cluster-twc-work-pool-00dbfdfb-ui9a   <none>           <none>

```


###防火墙设置
```bash

systemctl disable firewalld 
systemctl restart network 
sestatus  #查看
setencforce 0  #关闭防火墙

```

### iptables, dos攻击：
```bash

iptables -L -n #查看

#https://blog.csdn.net/song123sh/article/details/124229841
# 防止dos攻击 白名单 + iptables + 安全漏洞 + 隐藏源ip
iptables -I INPUT -p tcp -dport 80 -m state -state NEW -m recent -set
iptables -I INPUT -p tcp -dport 80 -m state-state NEW -m recent -update -seconds 30 -hitcount 10 j DROP  #封杀每30秒与80端口建立连接超过10个的IP地址
```



### mtu, mss, 滑动窗口 拥塞窗口
```bash
$ ping -s 1460 -M do baidu.com 
[root@centos ~]# ping -s 1500 -M do baidu.com
PING baidu.com (110.242.68.66) 1500(1528) bytes of data.
ping: local error: Message too long, mtu=1500
ping: local error: Message too long, mtu=1500

# 是网络的最大传输单元,最大传输单元(MaximumTransmissionUnit，MTU)
# https://tsov.net/uupee/17420/
ifconfig ens33 mtu 1488 up #设置mtu大小
netstat -i # 查看各个网卡的mtu大小

# https://www.jianshu.com/p/399049fa1648
# MSS = MTU - IP header头大小 - TCP 头大小
[root@master01 ~]# netstat -i
Kernel Interface table
Iface             MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
docker0          1500        0      0      0 0             0      0      0      0 BMU
ens33            1500     1621      0      0 0          1094      0      0      0 BMRU
lo              65536   391996      0      0 0        391996      0      0      0 LRU
virbr0           1500        0      0      0 0             0      0      0      0 BMU

ifconfig eth0 mtu 1400  #改变ntu的值 重启之后会复原
ip link set dev eth0 mtu 1400

```


###  tcp 网络缓冲区大小：
```bash
cat /proc/sys/net/core/rmem_default
cat /proc/sys/net/core/wmem_default
cat /proc/sys/net/core/rmem_max  # tcp 或udp收发缓冲区最大值
cat /proc/sys/net/ipv4/tcp_wmem  # tcp 发送缓冲区的默认值
4096	16384	4194304   #//第一个表示最小值，第二个表示默认值，第三个表示最大值。
cat /proc/sys/net/ipv4/tcp_rmem

/proc/sys/net/


yum install speedtest-cli -y #测速包
ifconfig 
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.5.100  netmask 255.255.255.0  broadcast 192.168.5.255
        inet6 fe80::b750:3003:9565:df7d  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:09:ff:98  txqueuelen 1000  (Ethernet)
        RX packets 808725  bytes 95545448 (91.1 MiB)   #收包和收包字节数
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3475013  bytes 8339504836 (7.7 GiB)  #发包和收发字节数
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

#实时监控 
 watch -n 1 -d ifconfig ens33 @
 yum install iftop -y 
 iftop
 iftop -i ens33
 

```


Q: 不能操作 /etc/sysconfig/network-scripts/ifcfg-ens33?   
A: root 登录 su root